# PYTHON_SCRIPT_PARALLEL_HANA_CLOUD
This repository provides a python script and a bash script which can be used to run a set of SQL's in parallel on the OS

I had used this script to Stress test a HANA cloud system by executing a list of SQL concurrently for 20 Users. 


![image](https://user-images.githubusercontent.com/41034062/165502289-d91ca3f6-3b2f-4a81-9a1e-15537c6349f8.png)

![image](https://user-images.githubusercontent.com/41034062/165502371-74519b24-e425-43b4-9d4d-b6dfa5175963.png)

In the sub_process.py file there is a sql_cmd_list string which contains 18 long running HANA spatial SQL statements seperated by a ";" :

example below : 
''' sql_cmd_list='CREATE COLUMN TABLE TAXI LIKE "HC_DEMO"."TAXI" WITH DATA;ALTER TABLE TAXI ADD (SHAPE ST_GEOMETRY(5018));UPDATE TAXI SET SHAPE = ST_GEOMFROMTEXT(POLYLINE, 4326).ST_TRANSFORM(5018);ALTER TABLE TAXI ADD (STARTPOINT ST_GEOMETRY(5018), ENDPOINT ST_GEOMETRY(5018));UPDATE TAXI SET STARTPOINT = SHAPE.ST_STARTPOINT(), ENDPOINT = SHAPE.ST_ENDPOINT();ALTER TABLE TAXI ADD (DURATION INTEGER);UPDATE TAXI SET DURATION = (SHAPE.ST_NUMPOINTS() - 1) * 15;ALTER TABLE TAXI ADD (STARTTIME TIMESTAMP, ENDTIME TIMESTAMP);UPDATE TAXI SET STARTTIME = TIMESTAMP, ENDTIME = ADD_SECONDS(TIMESTAMP, DURATION);ALTER TABLE TAXI ADD (DISTANCE INTEGER);UPDATE TAXI SET DISTANCE = TO_INTEGER(SHAPE.ST_LENGTH());ALTER TABLE TAXI ADD (SPEED_AVG INTEGER);UPDATE TAXI SET SPEED_AVG = TO_INTEGER(DISTANCE/DURATION * 3.6);SELECT ST_CONVEXHULLAGGR(SHAPE).ST_TRANSFORM(4326).ST_ASWKT() FROM TAXI;CREATE COLUMN TABLE OSM_POI LIKE "HC_DEMO".osm_poi WITH DATA;CREATE COLUMN TABLE REFGRID LIKE "HC_DEMO".REFGRID WITH DATA;SELECT HEXID, HEXCENTROID.ST_TRANSFORM(4326).ST_ASWKT() AS HEXCENTROID,HEXCELL.ST_TRANSFORM(4326).ST_ASWKT() AS HEXCELL FROM REFGRID;SELECT TOP 1000 INDEX, TRIP_ID, CALL_TYPE, TAXI_ID, STARTTIME, ENDTIME,SPEED_AVG,SHAPE.ST_TRANSFORM(4326).ST_ASWKT() as SHAPE FROM TAXI ORDER BY RAND();SELECT B.OSMID, B.SHAPE.ST_TRANSFORM(4326).ST_ASWKT() AS OSMSHAPE, B.AMENITY, B.NAME, A.HEXCELL.ST_TRANSFORM(4326).ST_ASWKT() AS HEXSHAPE FROM (SELECT TOP 3 ST_CLUSTERCELL() AS HEXCELL FROM TAXI GROUP CLUSTER BY STARTPOINT USING HEXAGON X CELLS 500 ORDER BY COUNT(*) DESC) A LEFT JOIN OSM_POI B ON A.HEXCELL.ST_INTERSECTS(B.SHAPE) = 1;'''

Python script also creates a CSV file output with details of the execution of each of the 18 SQL commands. 

Once the execution starts HANA Cloud performance can be monitored from HANA Cockpit : 

![image](https://user-images.githubusercontent.com/41034062/165503439-9406168f-d73a-44ce-bd18-7ef68b1f83da.png)
